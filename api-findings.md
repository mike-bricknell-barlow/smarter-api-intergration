# Smarter Live – Unofficial Firebase API Contract

> Reverse-engineered from Android package: `am.smarter.smarter3`  
> Backend: Firebase Realtime Database  
> Project ID: `smarter-live`  
> Base URL: `https://smarter-live.firebaseio.com/`

# 1. Authentication

All requests require a Firebase Authentication ID token.

Append to every request:

`?auth=<FIREBASE_ID_TOKEN>`

Example:

`https://smarter-live.firebaseio.com/devices/<deviceId>.json?auth=<ID_TOKEN>`

## Obtaining IDToken

Make a `POST` request to `https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=<API Key>`

Pass the following JSON body:

```
{
    "email": "<email address>",
    "password": "<password>",
    "returnSecureToken": true
}
```

Use the email address and password associated with your Smarter account (the one used to login to the app).

Response example:

```
{
    "kind": "identitytoolkit#VerifyPasswordResponse",
    "localId": "<local ID number>",
    "email": "<your email>",
    "displayName": "",
    "idToken": "<your id token>",
    "registered": true,
    "refreshToken": "<your refresh token>",
    "expiresIn": "3600"
}
```

# 2. Database Structure

Root layout:

```
devices/
<deviceId>/
commands/
notifications/
status/
settings/
state/
```

Devices are **top-level objects**, not nested under users.

# 3. Device Commands API

## Base Path

`/devices/<deviceId>/commands/<command>/`

Commands use **push keys** (POST creates child nodes).

## 3.1 Start Brew

### Endpoint

`POST /devices/<deviceId>/commands/start_brew.json?auth=<ID_TOKEN>`

### Body

```
true
```

Result

Creates:

`devices/<deviceId>/commands/start_brew/<pushKey> = true`

### 3.2 Stop Brew

`POST /devices/<deviceId>/commands/stop_brew.json?auth=<ID_TOKEN>`


Body:

```
true
```

### 3.3 Set Cups

`POST /devices/<deviceId>/commands/set_cups.json?auth=<ID_TOKEN>`

Body:

```
2
```

### 3.4 Set Strength

`POST /devices/<deviceId>/commands/set_strength.json?auth=<ID_TOKEN>`

Body:

```
"STRONG"
```

(Exact enum values depend on app definitions.)

### 3.5 Generic Command Template

`POST /devices/<deviceId>/commands/<commandName>.json?auth=<ID_TOKEN>`

Body:

```
<value>
```

# 4. Device Notifications

Notifications are user-scoped.

Path

`/devices/<deviceId>/notifications/<userId>/<key>`

## Example

Enable notification:

`PUT /devices/<deviceId>/notifications/<userId>/<notificationKey>.json?auth=<ID_TOKEN>`

Body:

```
true
```

# 5. Reading Device State

Get Entire Device Object

`GET /devices/<deviceId>.json?auth=<ID_TOKEN>`

Returns:

```
{
  "status": { ... },
  "settings": { ... },
  "state": { ... },
  "commands": { ... },
  "notifications": { ... }
}
```

Get Device Status Only

`GET /devices/<deviceId>/status.json?auth=<ID_TOKEN>`

6. Command Pattern

Commands use Firebase push keys:

`devices/<deviceId>/commands/<command>/<autoGeneratedKey>`

This implies:

 * Device listens for new child nodes
 * Executes when detected
 * May remove or mark processed after execution

7. HTTP Method Mapping

| Firebase Action      | REST Method |
| ----------- | ----------- |
| `push()`     | `POST`       |
| `setValue()`  | `PUT`        |
| `read` | `GET` |
| `delete` | `DELETE` |

8. Example cURL – Start Brew

```
curl -X POST \
  -H "Content-Type: application/json" \
  -d 'true' \
  "https://smarter-live.firebaseio.com/devices/DEVICE_ID/commands/start_brew.json?auth=ID_TOKEN"
```

9. Security Model

 * Devices are globally addressable under /devices
 * Access control enforced via Firebase security rules
 * Auth token required for read/write
 * User ID used for notifications scoping

10. Known Command Names

`start_brew`

`stop_brew`

`set_cups`

`set_strength`

`set_keep_warm`

`set_pre_heat_time`

`set_grind`

`set_auto_brew`

(Exact availability depends on device type.)